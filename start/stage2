#!/bin/sh

startStage2(){
   local -
   set -e +a +m +s +i -f
   . /start/stage2.functions
   local isFirstRun=$1
   while read var
   do 
      eval "local $var"
   done < /environment/vars
   if [ "$isFirstRun" == "true" ]
   then
      createLinuxUser
      updateSudoersConf
      fixHosts
      makeAllFromList "$(allVars noquote)"
      fixPermissionsForUsrLocalBin
   fi
   tryRunStage 3
   allVars quote > /environment/vars
   execCmdAsLinuxUser "$VAR_FINAL_COMMAND"
}

readonly IFS_bak=$IFS
startStage2 $1
