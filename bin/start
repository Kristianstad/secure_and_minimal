#!/bin/sh
set -e +a +m +s +i -f

if [ ! -f "$CONST_BIN_DIR/start.stage3" ]
then
   echo "Nothing to do! Exiting."
   exit 0
fi

# Set by sudo command:
# -------------------------------------------
# SUDO_USER
# -------------------------------------------

# Set in Dockerfile or at runtime:
# -------------------------------------------
# CONST_BIN_DIR
# CONST_SUDOERS_DIR
# VAR_LINUX_USER
# VAR_ENVIRONMENT_DIR
# -------------------------------------------

readonly SUDO_USER
readonly BIN_DIR="$CONST_BIN_DIR"
readonly LINUX_USER="$VAR_LINUX_USER"
readonly ENVIRONMENT_DIR="$VAR_ENVIRONMENT_DIR/"
readonly RUNTIME_ENVIRONMENT="$ENVIRONMENT_DIR/runtime_environment"
readonly RESTART_ENVIRONMENT="$ENVIRONMENT_DIR/restart_environment"
readonly HOSTNAME="$(/bin/hostname)"

. start.stage1.functions

if [ -f "$RUNTIME_ENVIRONMENT" ]
then
   firstrun
fi

exec /usr/bin/env -i "$BIN_DIR/start.stage2"
